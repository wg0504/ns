<!doctype html>
<html>

<head>
    <meta name="viewport" content="width=device-width,inital-scale=1,maximum-scale=1.0,user-scalable=0">
    </meta>
    <link rel='stylesheet' href='/stylesheets/gallery_view.css' />
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:100,300,400,500,700,900" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
    </script>
</head>

<script>
    function fixH() {
        $('html, body').animate({scrollTop:0},0);
        // $('html, body').css('position','fixed');
        // $('html, body').css('top', '0px');
        // $('html, body').css('overflow','hidden');
    }

    function gallery_delete() {
        $('.title').text(window.innerHeight);
        var $el = $('#layer');
        var isDim = $el.prev().hasClass('dim_bg');

        isDim ? $('.dim_layer').fadeIn() : $el.fadeIn();

        var $elWidth = ~~($el.outerWidth()),
            $elHeight = ~~($el.outerHeight()),
            docWidth = $(document).width(),
            docHeight = $(document).height();

        // 화면의 중앙에 레이어를 띄운다.
        if ($elHeight < docHeight || $elWidth < docWidth) {
            $el.css({
                marginTop: -$elHeight / 2,
                marginLeft: -$elWidth / 2
            })
        } else {
            $el.css({
                top: 0,
                left: 0
            });
        }

        $el.find('.pop_cancel').click(function () {
            isDim ? $('.dim_layer').fadeOut() : $el.fadeOut();
            return false;
        });

        $el.find('.pop_delete').click(function () {
            delete_gallery.submit();
            isDim ? $('.dim_layer').fadeOut() : $el.fadeOut();
            return false;
        });

        $('.dim_bg').click(function () {
            $('.dim_layer').fadeOut();
            return false;
        });
    }

    function goLeft() {
        // console.log('goLeft');
        var $this = $('.selimg');
        $this.removeClass('selimg');
        $this.prev().addClass('selimg');
        $('.icon1-r').css('display', 'flex');
        if ($('.selimg').hasClass('startimg')) {
            $('.icon1-l').css('display', 'none');
        }
    }

    function goRight() {
        // console.log('goRight');
        var $this = $('.selimg');
        $this.removeClass('selimg');
        $this.next().addClass('selimg');
        $('.icon1-l').css('display', 'flex');
        if ($('.selimg').hasClass('endimg')) {
            $('.icon1-r').css('display', 'none');
        }
    }

    function replyWrite() {
        if (reply_gallery.r_content.value == "") {
            return false;
        } else {
            reply_gallery.submit();
        }
    }

    function reply_show() {
        var $btn = $('.reply_btn');
        if ($btn.hasClass('up')) {
            $btn.removeClass('up');
            $btn.addClass('down');
            $('.reply_icon1').css('display', 'none');
            $('.reply_icon2').css('display', 'block');
            $('.fold2').slideDown(0, () => {
                var h = $('.reply_add_box').css('height');
                $('.reply_area').css('height', 'calc(100vh - 168px - ' + h + ')');
                $('.fold1').slideUp();
            });
        } else {
            $btn.removeClass('down');
            $btn.addClass('up');
            $('.reply_icon1').css('display', 'block');
            $('.reply_icon2').css('display', 'none');
            $('.fold1').slideDown(400, () => {
                $('.fold2').slideUp(0);
            });
        }
    }
</script>
<style>
    .container {
        display: flex;
        flex-direction: column;
        background-color: #000000;
        width: 100vw;
        /* height: 100vh; */
        /* max-height: 100vh; */
    }

    .title {
        height: 29px;
        font-size: 20px;
        font-weight: bold;
        font-style: normal;
        font-stretch: normal;
        line-height: normal;
        letter-spacing: normal;
        color: #ffffff;
        margin-top: 30px;
        margin-left: 27px;
        margin-right: 27px;
    }

    .subtitle {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        margin-left: 27px;
        margin-right: 27px;
    }

    .g_date {
        font-size: 13px;
        font-weight: 500;
        font-style: normal;
        font-stretch: normal;
        line-height: normal;
        letter-spacing: normal;
        color: #ffffff;
    }

    .g_picture_box {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        margin-top: 20px;
        margin-bottom: 20px;
        margin-left: 27px;
        margin-right: 27px;
    }

    .imgbox {
        display: none;
        width: 70vw;
        height: 70vw;
    }

    .imgbox.selimg {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
    }

    .img1 {
        max-width: 100%;
        max-height: 100%;
        margin: auto;
    }

    .left_btn,
    .right_btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 40px;
    }

    .icon-l,
    .icon-r {
        width: 100%;
        height: 100%;
    }

    .icon1-l {
        display: none;
    }

    .g_content {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        margin-left: 27px;
        margin-right: 27px;
    }

    .g_text {
        background-color: #000000;
        border: solid 0px #000000;
        width: 90%;
        height: calc(100vh - 212px - 70vw);
        font: 500 15px Noto Sans KR;
        font-size: 15px;
        font-weight: 500;
        font-style: normal;
        font-stretch: normal;
        line-height: normal;
        letter-spacing: normal;
        color: #ffffff;
        resize: none;
    }

    .reply_btn {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        flex-grow: 1;
        height: 85px;
        position: relative;
        bottom: 0;
        background-color: #000000;
        margin-left: 27px;
        margin-right: 27px;
    }

    .btn_text {
        font-size: 20px;
        font-weight: 600;
        font-style: normal;
        font-stretch: normal;
        line-height: normal;
        letter-spacing: normal;
        color: #ffffff;
    }

    .r_head {
        display: flex;
        flex-direction: row;
        align-items: center;
    }

    .r_name {
        margin-left: 9px;
        font-size: 15px;
        font-weight: bold;
        font-style: normal;
        font-stretch: normal;
        line-height: normal;
        letter-spacing: normal;
        color: #ffffff;
    }

    .r_con {
        margin-left: 30px;
        font-size: 15px;
        font-weight: 500;
        font-style: normal;
        font-stretch: normal;
        line-height: normal;
        letter-spacing: normal;
        color: #ffffff;
        margin-bottom: 10px;
    }

    .oval_box {
        width: 18px;
        height: 18px;
    }

    .oval_icon {
        width: 100%;
        height: 100%;
    }

    .fold2 {
        display: none;
    }

    .reply_icon2 {
        display: none;
        transform: rotate(180deg);
    }

    .reply_area {
        height: 400px;
        overflow: auto;
        margin-left: 30px;
        margin-right: 30px;
    }

    .reply_add_box {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        position: relative;
        bottom: 0;
        width: 100%;
        height: 85px;
        background-color: #252525;
    }

    .line {
        height: 1px;
        background-color: #333333;
        margin-bottom: 15px;
        margin-left: 1px;
        margin-right: 1px;
    }

    .reply_add_btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 47px;
        height: 36px;
        background-color: #181f72;
    }

    .btn_text2 {
        font-size: 15px;
        font-weight: 400;
        font-style: normal;
        font-stretch: normal;
        line-height: normal;
        letter-spacing: normal;
        color: #ffffff;
    }

    .reply_input {
        width: 70vw;
        height: 36px;
        padding: 0px;
        padding-left: 10px;
        padding-right: 10px;
        font: 300 16px Noto Sans KR;
        border: solid 0px #333333;
    }

    input::placeholder {
        font-size: 15px;
        font-weight: 500;
        font-style: normal;
        font-stretch: normal;
        line-height: normal;
        letter-spacing: normal;
        color: #cbcbcb;
    }
</style>

<body>
    <form name="delete_gallery" action="/gallery_delete" method="POST">
        <input type="hidden" name="g_idx" value=<%=gall[0].g_idx%> />
    </form>
    <div class="dim_layer">
        <div class="dim_bg"></div>
        <div id="layer" class="pop_layer">
            <div class="pop_box">
                <div class="pop_col1">
                    <div class="pop_text">
                        삭제하시겠습니까?
                    </div>
                </div>
                <div class="pop_rowline"></div>
                <div class="pop_col2">
                    <div class="pop_cancel">
                        <div class="pop_text">
                            취소
                        </div>
                    </div>
                    <div class="pop_colline"></div>
                    <div class="pop_delete">
                        <div class="pop_text">
                            삭제
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <% var imgArray = gall[0].g_image.split(",");%>
        <div class="title"><%=gall[0].g_title%></div>
        <div class="subtitle">
            <div class="g_date"><%=gall[0].g_date%></div>
            <% if(gall[0].g_uidx == u_idx){ %>
            <div class="del_img_box" onclick="gallery_delete()"><img src="images/gallery_delete.svg" alt="사진없음" /></div>
            <% } %>
        </div>
        <div class="fold1">
            <div class="g_picture_box">
                <div class="left_btn"><img class="icon1-l" src="images/g_left-arrow.svg" alt="사진없음"
                        onclick="goLeft()" /></div>
                <%for(var i=0; i<imgArray.length; i++) {
                    if(i==0) {%>
                <div class="imgbox selimg startimg" data-arrIdx=<%=i%>>
                    <img class="img1" src="gallery/<%=imgArray[i]%>" alt="사진없음" />
                </div>
                <%} else {%>
                <%if(i==(imgArray.length-1)) {%>
                <div class="imgbox endimg" data-arrIdx=<%=i%>>
                    <img class="img1" src="gallery/<%=imgArray[i]%>" alt="사진없음" />
                </div>
                <%} else {%>
                <div class="imgbox" data-arrIdx=<%=i%>>
                    <img class="img1" src="gallery/<%=imgArray[i]%>" alt="사진없음" />
                </div>
                <%}}}%>
                <div class="right_btn">
                    <% if(imgArray.length != 1){%>
                    <img class="icon1-r" src="images/g_right-arrow.svg" alt="사진없음" onclick="goRight()" />
                    <%}%>
                    </div>
                </div>
                <div class="g_content"><textarea class="g_text" disabled><%=gall[0].g_content%></textarea></div>
            </div>
            <div class="reply_btn up" onclick="reply_show()">
                <div class="btn_text">댓글 (<%=reply.length%>)</div>
                <div class="btn_icon"><img class="reply_icon1" src="images/opencon.svg" alt="사진없음" /><img
                        class="reply_icon2" src="images/opencon.svg" alt="사진없음" /></div>
            </div>
            <div class="fold2">
                <div class="reply_area">
                    <% for(var i=0; i<reply.length; i++){%>
                    <div class="r_head">
                        <div class="oval_box">
                            <%switch(reply[i].u_industry){
                                    case 1:%>
                            <img class="oval_icon" src="images/oval_red.svg" alt="사진없음" />
                            <%break;
                                    case 2:%>
                            <img class="oval_icon" src="images/oval_orange.svg" alt="사진없음" />
                            <%break;
                                    case 3:%>
                            <img class="oval_icon" src="images/oval_yellow.svg" alt="사진없음" />
                            <%break;
                                    case 4:%>
                            <img class="oval_icon" src="images/oval_green.svg" alt="사진없음" />
                            <%break;
                                    case 5:%>
                            <img class="oval_icon" src="images/oval_blue.svg" alt="사진없음" />
                            <%break;
                                    case 6:%>
                            <img class="oval_icon" src="images/oval_navy.svg" alt="사진없음" />
                            <%break;
                                    case 7:%>
                            <img class="oval_icon" src="images/oval_purple.svg" alt="사진없음" />
                            <%break;
                                }%>
                        </div>
                        <div class="r_name"><%=reply[i].u_name%></div>
                    </div>
                    <div class="r_con"><%=reply[i].rg_content%></div>
                    <%if(i != (reply.length-1)){%>
                    <div class="line"></div>
                    <%}}%>
                </div>
                <%if(u_idx){%>
                <form name="reply_gallery" action="/gallery_reply" method="POST">
                    <div class="reply_add_box">
                        <input type="hidden" name="u_idx" value='<%=u_idx%>' />
                        <input type="hidden" name="r_gidx" value='<%=gall[0].g_idx%>' />
                        <input type="text" class="reply_input" name="r_content" placeholder="댓글을 입력하세요." onclick="fixH()"/>
                        <div class="reply_add_btn" onclick="replyWrite()">
                            <div class="btn_text2">등록</div>
                        </div>
                    </div>
                </form>
                <%}else{%>
                <div class="reply_add_box" style="height:0px;"></div>
                <%}%>
            </div>
            <div class="black_bg"></div>
        </div>
</body>
<!-- <script>
    const _C = document.querySelector('.container');

        let i = 0;
        let x0 = null;

        function unify(e) {
            return e.changedTouches ? e.changedTouches[0] : e;
        }

        function lock(e) {
            x0 = unify(e).clientX;
        }

        function move(e) {
            if (x0 || x0 === 0) {
                let dx = unify(e).clientX - x0;
                let s = Math.sign(dx);
                if(dx < -50){
                    // console.log('left');
                } else if (dx > 50) {
                    // console.log('right');
                    window.history.back();
                }
            }
        }

        _C.addEventListener('mousedown', lock, false);
        _C.addEventListener('touchstart', lock, false);

        _C.addEventListener('touchmove', e => {
            e.preventDefault()
        }, false);

        _C.addEventListener('mouseup', move, false);
        _C.addEventListener('touchend', move, false);
</script> -->
</html>